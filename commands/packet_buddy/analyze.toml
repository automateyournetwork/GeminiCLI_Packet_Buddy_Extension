name = "/packet_buddy:analyze"
description = "Upload, convert, sanitize, index, and analyze a PCAP in one step."
args = ["question", "path?=./capture.pcap"]
prompt = """
SESSION=$(mcp tools call new_session | jq -r .result)
echo "ðŸ†•  Session: $SESSION"

echo "ðŸ“¤  Uploading $path â€¦"
BASE64=$(base64 -w 0 "$path")
mcp tools call upload_pcap_base64 --arguments "{\\"session_id\\": \\"$SESSION\\", \\"filename\\": \\"$(basename "$path")\\", \\"data_b64\\": \\"$BASE64\\"}"

echo "ðŸ”„  Converting to JSON â€¦"
mcp tools call convert_to_json --arguments "{\\"session_id\\": \\"$SESSION\\"}"

echo "ðŸ§¹  Sanitizing payloads â€¦"
mcp tools call sanitize_json --arguments "{\\"session_id\\": \\"$SESSION\\", \\"aggressive\\": true}"

echo "ðŸ“š  Indexing capture â€¦"
mcp tools call index_pcap --arguments "{\\"session_id\\": \\"$SESSION\\"}"

echo "ðŸ¤–  Running AI analysis â€¦"
mcp tools call analyze_pcap --arguments "{\\"session_id\\": \\"$SESSION\\", \\"question\\": \\"$question\\"}"
"""